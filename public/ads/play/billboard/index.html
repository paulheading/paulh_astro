<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Barbican PLAY!</title>
    <style>
      :root {
        --backgroundColor: #add2f7;
        --color: #ff4a00;
        --sprite: 157px;
        --height: 250px;
        --width: 970px;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
      }

      .fallback {
        background-color: black;
        justify-content: center;
        font-family: sans-serif;
        height: var(--height);
        align-items: center;
        width: var(--width);
        text-align: center;
        max-height: 100%;
        max-width: 100%;
        color: white;
        padding: 1rem;
        display: flex;
      }

      a {
        background-color: var(--backgroundColor);
        background: url("sky.png");
        height: var(--height);
        width: var(--width);
        position: relative;
        overflow: hidden;
        display: none;
      }

      @media (min-width: 970px) and (min-height: 250px) {
        a {
          display: block;
        }

        .fallback {
          display: none;
        }
      }

      #menu {
        background-color: black;
        position: absolute;
        height: 100%;
        width: 100%;
        z-index: 4;
        left: 0;
        top: 0;
      }

      #menu img {
        position: absolute;
      }

      #wordmark {
        z-index: 2;
        left: 10px;
        top: 10px;
      }

      #date {
        left: 117px;
        z-index: 2;
        top: 63px;
      }

      #title {
        left: 117px;
        z-index: 2;
        top: 117px;
      }

      #subtitle {
        left: 439px;
        z-index: 2;
        top: 33px;
      }

      #copy {
        left: 438px;
        z-index: 2;
        top: 103px;
      }

      #book {
        left: 439px;
        top: 176px;
        z-index: 2;
      }

      #man {
        position: absolute;
        overflow: hidden;
        height: 156px;
        width: 156px;
        z-index: 3;
        left: 60px;
        bottom: 0;
      }

      #sprite {
        position: relative;
      }

      #highwalk {
        position: absolute;
        z-index: 2;
        top: 129px;
        left: 0px;
      }

      #horizontal {
        background-color: var(--color);
        width: var(--width);
        position: absolute;
        opacity: 0.5;
        height: 2px;
        z-index: 1;
      }

      #vertical {
        background-color: var(--color);
        height: var(--height);
        position: absolute;
        opacity: 0.5;
        width: 2px;
        z-index: 1;
        right: 0;
      }
    </style>
  </head>
  <body>
    <div class="fallback">Please view this example on a larger screen.</div>
    <a href="https://www.barbican.org.uk/whats-on/2018/event/play">
      <div id="menu">
        <img id="wordmark" src="wordmark.png" />
        <img id="date" src="date.png" />
        <img id="title" src="title.png" />
        <img id="subtitle" src="subtitle.png" />
        <img id="copy" src="copy.png" />
        <img id="book" src="book.png" />
        <div id="horizontal"></div>
        <div id="vertical"></div>
      </div>
      <div id="man">
        <img id="sprite" src="sprite.png" />
      </div>
      <img id="highwalk" src="highwalk.png" />
    </a>
  </body>
</html>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<script>
  const tl = gsap.timeline({ repeat: -1, repeatDelay: 4 });

  const fast = 0.3;

  const slow = fast * 10;

  const delay = fast;

  const width = 970;

  const highwalk = width * 0.5;

  const ease = "steps(18)";

  const $menu = "#menu";

  const $man = "#man";
  const $sprite = "#sprite";
  const $highwalk = "#highwalk";
  const $wordmark = "#wordmark";
  const $date = "#date";
  const $title = "#title";
  const $subtitle = "#subtitle";
  const $copy = "#copy";
  const $book = "#book";
  const $horizontal = "#horizontal";
  const $vertical = "#vertical";

  const information = [$wordmark, $date, $title, $subtitle, $copy, $book];

  function Run() {
    const loop = Array.from(Array(8).keys());

    const tl = gsap.timeline();

    // prettier-ignore
    loop.forEach((index) => tl.set($sprite, { x: -180, delay: index > 0 ? delay: 0 }).set($sprite, { x: -360, delay }))
  }

  function Line(target, movements) {
    var ease = "none";

    var duration = 1;

    var tl = gsap.timeline({ defaults: { ease, duration } });

    movements.forEach((movement) => tl.to(target, movement));
  }

  function onComplete() {
    Line($vertical, [{ x: -300 }, { x: -100 }, { x: -220 }]);
    Line($horizontal, [{ y: 200 }, { y: 50 }, { y: 95 }]);
  }

  // prettier-ignore
  tl.set([$vertical, $horizontal], { x: 0, y: 0 })
    .set([$man, $sprite], { x: 0 })
    .from($man, { y: -300 })
    .to($man, { duration: slow, x: width, ease, onStart: Run }, 'run')
    .to($highwalk, { duration: slow, x: -highwalk, ease }, 'run')
    .from($menu, { duration: fast, opacity: 0 })
    .from(information, { duration: fast, y: -20, opacity: 0, stagger: 0.1, onComplete });
</script>
